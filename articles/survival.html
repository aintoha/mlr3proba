<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Survival Analysis in mlr3proba • mlr3proba</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<link href="../extra.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Survival Analysis in mlr3proba">
<meta property="og:description" content="">
<meta property="og:image" content="https://mlr3proba.mlr-org.com/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mlr3proba</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">
    <span class="fa fa fa fa-file-alt"></span>
     
    Reference
  </a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://mlr3book.mlr-org.com">
    <span class="fa fa fa fa-link"></span>
     
    mlr3book
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/survival.html">Survival Analysis in mlr3proba</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlr-org/mlr3proba">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.slack.com">
    <span class="fab fa fab fa-slack"></span>
     
  </a>
</li>
<li>
  <a href="https://stackoverflow.com/questions/tagged/mlr">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li>
  <a href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Survival Analysis in mlr3proba</h1>
                        <h4 class="author">Raphael Sonabend</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3proba/blob/master/vignettes/survival.Rmd"><code>vignettes/survival.Rmd</code></a></small>
      <div class="hidden name"><code>survival.Rmd</code></div>

    </div>

    
    
<p>This vignette is an introduction to performing survival analysis in <strong>mlr3proba</strong>.</p>
<div id="a-very-quick-introduction-to-survival-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#a-very-quick-introduction-to-survival-analysis" class="anchor"></a>A very quick introduction to survival analysis</h2>
<p>Survival analysis is a sub-field of supervised machine learning in which the aim is to predict the survival distribution of a given individual. Arguably the main feature of survival analysis is that unlike classification and regression, learners are trained on two features: 1. the time until the event takes place, 2. the event type: either censoring or death. At a particular time-point, an individual is either: alive, dead, or censored. Censoring occurs if it is unknown if an individual is alive or dead. For example, say we are interested in patients in hospital and every day it is recorded if they are alive or dead, then after a patient leaves it is unknown if they are alive or dead, hence they are censored.</p>
<p>In the case that there is no censoring, but a predicted probability distribution is still the goal, then probabilistic regression learners are advised instead.</p>
</div>
<div id="survival-tasks" class="section level2">
<h2 class="hasAnchor">
<a href="#survival-tasks" class="anchor"></a>Survival Tasks</h2>
<p>Unlike <code>TaskClassif</code> and <code>TaskRegr</code> which have a single ‘target’ argument, <code>TaskSurv</code> mimics the <code><a href="https://rdrr.io/pkg/survival/man/Surv.html">survival::Surv</a></code> object and has three-four target arguments (dependent on censoring type)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># type = "right" is default</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">TaskSurv<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"right_censored"</span>, <span class="dt">backend =</span> survival<span class="op">::</span>rats,</a>
<a class="sourceLine" id="cb1-4" title="4">             <span class="dt">time =</span> <span class="st">"time"</span>, <span class="dt">event =</span> <span class="st">"status"</span>, <span class="dt">type =</span> <span class="st">"right"</span>)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">#&gt; &lt;TaskSurv:right_censored&gt; (300 x 5)</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">#&gt; * Target: time, status</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">#&gt; * Properties: -</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">#&gt; * Features (3):</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">#&gt;   - int (1): litter</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">#&gt;   - dbl (1): rx</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">#&gt;   - chr (1): sex</span></a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13">task =<span class="st"> </span>TaskSurv<span class="op">$</span><span class="kw">new</span>(<span class="dt">id =</span> <span class="st">"interval_censored"</span>, <span class="dt">backend =</span> survival<span class="op">::</span>bladder2[,<span class="op">-</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">7</span>)],</a>
<a class="sourceLine" id="cb1-14" title="14">                    <span class="dt">time =</span> <span class="st">"start"</span>, <span class="dt">time2 =</span> <span class="st">"stop"</span>, <span class="dt">type =</span> <span class="st">"interval2"</span>)</a>
<a class="sourceLine" id="cb1-15" title="15">task</a>
<a class="sourceLine" id="cb1-16" title="16"><span class="co">#&gt; &lt;TaskSurv:interval_censored&gt; (178 x 6)</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="co">#&gt; * Target: start, stop</span></a>
<a class="sourceLine" id="cb1-18" title="18"><span class="co">#&gt; * Properties: -</span></a>
<a class="sourceLine" id="cb1-19" title="19"><span class="co">#&gt; * Features (4):</span></a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">#&gt;   - dbl (2): enum, rx</span></a>
<a class="sourceLine" id="cb1-21" title="21"><span class="co">#&gt;   - int (2): number, size</span></a>
<a class="sourceLine" id="cb1-22" title="22">task<span class="op">$</span><span class="kw">truth</span>()[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb1-23" title="23"><span class="co">#&gt;  [1] [0,  1] [0,  4] [0,  7] [0, 10] [0,  6] [6, 10] [0, 14] [0, 18] [0,  5]</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co">#&gt; [10] [5, 18]</span></a></code></pre></div>
<div id="probability-distributions-with-distr6" class="section level3">
<h3 class="hasAnchor">
<a href="#probability-distributions-with-distr6" class="anchor"></a>Probability distributions with distr6</h3>
<p>Predicted distributions are implemented in <strong><a href="https://cran.r-project.org/web/packages/distr6/">distr6</a></strong>, which contains functionality for plotting and further analysis of probability distributions. See <a href="https://alan-turing-institute.github.io/distr6/">here</a> for full tutorials. Briefly we will go over the most important parts for <strong>mlr3proba</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">task =<span class="st"> </span><span class="kw">tsk</span>(<span class="st">"rats"</span>)</a>
<a class="sourceLine" id="cb2-2" title="2">learner =<span class="st"> </span><span class="kw">lrn</span>(<span class="st">"surv.coxph"</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co"># In general it is not advised to train/predict on same data</span></a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6">prediction =<span class="st"> </span>learner<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co"># The predicted `distr` is a VectorDistribution consisting of 300 separate distributions</span></a>
<a class="sourceLine" id="cb2-9" title="9"></a>
<a class="sourceLine" id="cb2-10" title="10">prediction<span class="op">$</span>distr</a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt; WeightDisc1 WeightDisc2 ... WeightDisc299 WeightDisc300</span></a>
<a class="sourceLine" id="cb2-12" title="12"></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co"># These can be extracted and queried</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co"># Either invidually</span></a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16">prediction<span class="op">$</span>distr[<span class="dv">1</span>]<span class="op">$</span><span class="kw">survival</span>(<span class="dv">60</span><span class="op">:</span><span class="dv">70</span>)</a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">#&gt;  [1] 0.9477634 0.9477634 0.9477634 0.9477634 0.9410540 0.9410540 0.9343536</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">#&gt;  [8] 0.9276584 0.9209361 0.9209361 0.9141730</span></a>
<a class="sourceLine" id="cb2-19" title="19">prediction<span class="op">$</span>distr[<span class="dv">1</span>]<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>()</a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#&gt; [1] 27.72981</span></a>
<a class="sourceLine" id="cb2-21" title="21"></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co"># Or together</span></a>
<a class="sourceLine" id="cb2-23" title="23"></a>
<a class="sourceLine" id="cb2-24" title="24">prediction<span class="op">$</span>distr<span class="op">$</span><span class="kw">cdf</span>(<span class="dv">60</span>)[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">#&gt;    WeightDisc1 WeightDisc2 WeightDisc3 WeightDisc4 WeightDisc5 WeightDisc6</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">#&gt; 1:  0.05223663  0.02369413  0.02369413 0.002470926  0.00110515  0.00110515</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">#&gt;    WeightDisc7 WeightDisc8 WeightDisc9 WeightDisc10</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">#&gt; 1:  0.05310445  0.02409379  0.02409379  0.002513064</span></a>
<a class="sourceLine" id="cb2-29" title="29">prediction<span class="op">$</span>distr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>()[,<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">#&gt;    WeightDisc1 WeightDisc2 WeightDisc3 WeightDisc4 WeightDisc5 WeightDisc6</span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="co">#&gt; 1:    27.72981    14.04936    14.04936    1.591479   0.7156143   0.7156143</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co">#&gt;    WeightDisc7 WeightDisc8 WeightDisc9 WeightDisc10</span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="co">#&gt; 1:     28.0962    14.26415    14.26415     1.618352</span></a>
<a class="sourceLine" id="cb2-34" title="34"></a>
<a class="sourceLine" id="cb2-35" title="35"><span class="co"># As well as plotted</span></a>
<a class="sourceLine" id="cb2-36" title="36"></a>
<a class="sourceLine" id="cb2-37" title="37"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(prediction<span class="op">$</span>distr[<span class="dv">1</span>], <span class="st">"survival"</span>, <span class="dt">main =</span> <span class="st">"First 2 Survival Curves"</span>)</a>
<a class="sourceLine" id="cb2-38" title="38"><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(prediction<span class="op">$</span>distr[<span class="dv">2</span>], <span class="st">"survival"</span>, <span class="dt">col =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="survival_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
</div>
</div>
<div id="composition" class="section level2">
<h2 class="hasAnchor">
<a href="#composition" class="anchor"></a>Composition</h2>
<p>Finally we take a look at the <code>PipeOp</code>s implemented in <strong>mlr3proba</strong>, which are used for composition of predict types. For example, if a learner only returns a linear predictor, then <code>PipeOpDistrCompositor</code> can be used to estimate a survival distribution. Or, if a learner returns a <code>distr</code> then <code>PipeOpCrankCompositor</code> can be used to estimate <code>crank</code> from <code>distr</code>. See <strong><a href="https://github.com/mlr-org/mlr3pipelines">mlr3pipelines</a></strong> for full tutorials and details on <code>PipeOp</code>s.</p>
<div id="pipeopdistrcompositor" class="section level3">
<h3 class="hasAnchor">
<a href="#pipeopdistrcompositor" class="anchor"></a>PipeOpDistrCompositor</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3pipelines)</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># PipeOpDistrCompositor - Train one model with a baseline distribution,</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># (Kaplan-Meier or Nelson-Aalen), and another with a predicted linear predictor.</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6">leaner_lp =<span class="st"> </span><span class="kw">lrn</span>(<span class="st">"surv.glmnet"</span>)</a>
<a class="sourceLine" id="cb3-7" title="7">leaner_distr =<span class="st"> </span><span class="kw">lrn</span>(<span class="st">"surv.kaplan"</span>)</a>
<a class="sourceLine" id="cb3-8" title="8">task =<span class="st"> </span><span class="kw">tsk</span>(<span class="st">"rats"</span>)</a>
<a class="sourceLine" id="cb3-9" title="9">prediction_lp =<span class="st"> </span>leaner_lp<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</a>
<a class="sourceLine" id="cb3-10" title="10">prediction_distr =<span class="st"> </span>leaner_distr<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</a>
<a class="sourceLine" id="cb3-11" title="11">prediction_lp<span class="op">$</span>distr</a>
<a class="sourceLine" id="cb3-12" title="12"><span class="co">#&gt; NULL</span></a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co"># Doesn't need training. Base = baseline distribution. ph = Proportional hazards.</span></a>
<a class="sourceLine" id="cb3-15" title="15"></a>
<a class="sourceLine" id="cb3-16" title="16">pod =<span class="st"> </span><span class="kw"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span>(<span class="st">"distrcompose"</span>, <span class="dt">param_vals =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">form =</span> <span class="st">"ph"</span>, <span class="dt">overwrite =</span> <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb3-17" title="17">prediction =<span class="st"> </span>pod<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">base =</span> prediction_distr, <span class="dt">pred =</span> prediction_lp))<span class="op">$</span>output</a>
<a class="sourceLine" id="cb3-18" title="18"></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co"># Now we have a predicted distr!</span></a>
<a class="sourceLine" id="cb3-20" title="20"></a>
<a class="sourceLine" id="cb3-21" title="21">prediction<span class="op">$</span>distr</a>
<a class="sourceLine" id="cb3-22" title="22"><span class="co">#&gt; WeightDisc1 WeightDisc2 ... WeightDisc299 WeightDisc300</span></a>
<a class="sourceLine" id="cb3-23" title="23"></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="co"># This can all be simplified by using the distrcompose wrapper</span></a>
<a class="sourceLine" id="cb3-25" title="25"></a>
<a class="sourceLine" id="cb3-26" title="26">cvglm.distr =<span class="st"> </span><span class="kw"><a href="../reference/distrcompositor.html">distrcompositor</a></span>(<span class="dt">learner =</span> <span class="kw">lrn</span>(<span class="st">"surv.cvglmnet"</span>),</a>
<a class="sourceLine" id="cb3-27" title="27">                             <span class="dt">estimator =</span> <span class="st">"kaplan"</span>,</a>
<a class="sourceLine" id="cb3-28" title="28">                             <span class="dt">form =</span> <span class="st">"aft"</span>,</a>
<a class="sourceLine" id="cb3-29" title="29">                             <span class="dt">overwrite =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-30" title="30">cvglm.distr<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</a>
<a class="sourceLine" id="cb3-31" title="31"><span class="co">#&gt; &lt;PredictionSurv&gt; for 300 observations:</span></a>
<a class="sourceLine" id="cb3-32" title="32"><span class="co">#&gt;     row_id time status      crank                distr         lp</span></a>
<a class="sourceLine" id="cb3-33" title="33"><span class="co">#&gt;          1  101  FALSE  0.0000000 &lt;VectorDistribution&gt;  0.0000000</span></a>
<a class="sourceLine" id="cb3-34" title="34"><span class="co">#&gt;          2   49   TRUE  0.0000000 &lt;VectorDistribution&gt;  0.0000000</span></a>
<a class="sourceLine" id="cb3-35" title="35"><span class="co">#&gt;          3  104  FALSE  0.0000000 &lt;VectorDistribution&gt;  0.0000000</span></a>
<a class="sourceLine" id="cb3-36" title="36"><span class="co">#&gt; ---                                                              </span></a>
<a class="sourceLine" id="cb3-37" title="37"><span class="co">#&gt;        298   92  FALSE -0.8301477 &lt;VectorDistribution&gt; -0.8301477</span></a>
<a class="sourceLine" id="cb3-38" title="38"><span class="co">#&gt;        299  104  FALSE -0.8301477 &lt;VectorDistribution&gt; -0.8301477</span></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="co">#&gt;        300  102  FALSE -0.8301477 &lt;VectorDistribution&gt; -0.8301477</span></a></code></pre></div>
</div>
<div id="pipeopcrankcompositor" class="section level3">
<h3 class="hasAnchor">
<a href="#pipeopcrankcompositor" class="anchor"></a>PipeOpCrankCompositor</h3>
<p>Note that a <code>PredictionSurv</code> will always return <code>crank</code>, but this may either be the same as the <code>lp</code> or the expectation of <code>distr</code>. This compositor allows you to change the estimation method.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># PipeOpCrankCompositor - Only one model required.</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">leaner =<span class="st"> </span><span class="kw">lrn</span>(<span class="st">"surv.coxph"</span>)</a>
<a class="sourceLine" id="cb4-4" title="4">prediction =<span class="st"> </span>leaner<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co"># Doesn't need training - Note: no `overwrite` option as `crank` is always</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"># present so the compositor if used will always overwrite.</span></a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9">poc =<span class="st"> </span><span class="kw"><a href="https://mlr3pipelines.mlr-org.com//reference/po.html">po</a></span>(<span class="st">"crankcompose"</span>, <span class="dt">param_vals =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">method =</span> <span class="st">"mean"</span>))</a>
<a class="sourceLine" id="cb4-10" title="10">composed_prediction =<span class="st"> </span>poc<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(prediction))<span class="op">$</span>output</a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co"># Note that whilst the actual values of `lp` and `crank` are different,</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co"># the rankings are the same, so discrimination measures are unchanged.</span></a>
<a class="sourceLine" id="cb4-14" title="14"></a>
<a class="sourceLine" id="cb4-15" title="15">prediction<span class="op">$</span>crank[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt;  [1]  1.6603932  0.8550971  0.8550971 -1.4162662 -2.2215623 -2.2215623</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt;  [7]  1.6773239  0.8720277  0.8720277 -1.3993355</span></a>
<a class="sourceLine" id="cb4-18" title="18">composed_prediction<span class="op">$</span>crank[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb4-19" title="19"><span class="co">#&gt;  [1] 27.7298076 14.0493649 14.0493649  1.5914788  0.7156143  0.7156143</span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="co">#&gt;  [7] 28.0961954 14.2641535 14.2641535  1.6183524</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(prediction<span class="op">$</span>crank) <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(composed_prediction<span class="op">$</span>crank))</a>
<a class="sourceLine" id="cb4-22" title="22"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="dt">Original =</span> prediction<span class="op">$</span><span class="kw">score</span>(), <span class="dt">Composed =</span> composed_prediction<span class="op">$</span><span class="kw">score</span>())</a>
<a class="sourceLine" id="cb4-24" title="24"><span class="co">#&gt;                Original  Composed</span></a>
<a class="sourceLine" id="cb4-25" title="25"><span class="co">#&gt; surv.harrellC 0.7780967 0.7780967</span></a>
<a class="sourceLine" id="cb4-26" title="26"></a>
<a class="sourceLine" id="cb4-27" title="27"><span class="co"># Again a wrapper can be used to simplify this</span></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="kw"><a href="../reference/crankcompositor.html">crankcompositor</a></span>(<span class="kw">lrn</span>(<span class="st">"surv.coxph"</span>), <span class="dt">method =</span> <span class="st">"mean"</span>)<span class="op">$</span><span class="kw">train</span>(task)<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(task)</a>
<a class="sourceLine" id="cb4-29" title="29"><span class="co">#&gt; &lt;PredictionSurv&gt; for 300 observations:</span></a>
<a class="sourceLine" id="cb4-30" title="30"><span class="co">#&gt;     row_id time status     crank                distr         lp</span></a>
<a class="sourceLine" id="cb4-31" title="31"><span class="co">#&gt;          1  101  FALSE 27.729808 &lt;VectorDistribution&gt;  1.6603932</span></a>
<a class="sourceLine" id="cb4-32" title="32"><span class="co">#&gt;          2   49   TRUE 14.049365 &lt;VectorDistribution&gt;  0.8550971</span></a>
<a class="sourceLine" id="cb4-33" title="33"><span class="co">#&gt;          3  104  FALSE 14.049365 &lt;VectorDistribution&gt;  0.8550971</span></a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co">#&gt; ---                                                             </span></a>
<a class="sourceLine" id="cb4-35" title="35"><span class="co">#&gt;        298   92  FALSE  3.597482 &lt;VectorDistribution&gt; -0.5866651</span></a>
<a class="sourceLine" id="cb4-36" title="36"><span class="co">#&gt;        299  104  FALSE  1.630197 &lt;VectorDistribution&gt; -1.3919612</span></a>
<a class="sourceLine" id="cb4-37" title="37"><span class="co">#&gt;        300  102  FALSE  1.630197 &lt;VectorDistribution&gt; -1.3919612</span></a></code></pre></div>
</div>
</div>
<div id="all-together" class="section level2">
<h2 class="hasAnchor">
<a href="#all-together" class="anchor"></a>All Together</h2>
<p>Putting all of this together we can perform a benchmark experiment to find the best learner for making predictions on a simulated dataset.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3pipelines); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mlr3tuning); <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(paradox)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">42</span>)</a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">task =<span class="st"> </span>TaskSurv<span class="op">$</span><span class="kw">new</span>(<span class="st">"brcancer"</span>, <span class="dt">backend =</span> mlr3misc<span class="op">::</span><span class="kw"><a href="https://mlr3misc.mlr-org.com/reference/load_dataset.html">load_dataset</a></span>(<span class="st">"brcancer"</span>,<span class="st">"simsurv"</span>),</a>
<a class="sourceLine" id="cb5-5" title="5">                    <span class="dt">time =</span> <span class="st">"rectime"</span>, <span class="dt">event =</span> <span class="st">"censrec"</span>)</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7">composed_lrn_glm =<span class="st"> </span><span class="kw"><a href="../reference/distrcompositor.html">distrcompositor</a></span>(<span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.glmnet"</span>), <span class="st">"kaplan"</span>, <span class="st">"ph"</span>)</a>
<a class="sourceLine" id="cb5-8" title="8"></a>
<a class="sourceLine" id="cb5-9" title="9">lrns =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"surv."</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"kaplan"</span>, <span class="st">"coxph"</span>, <span class="st">"parametric"</span>)), lrn)</a>
<a class="sourceLine" id="cb5-10" title="10">lrns[[<span class="dv">3</span>]]<span class="op">$</span>param_set<span class="op">$</span>values =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">dist =</span> <span class="st">"weibull"</span>, <span class="dt">type =</span> <span class="st">"ph"</span>)</a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">tuned_lrn_rf =<span class="st"> </span>AutoTuner<span class="op">$</span><span class="kw">new</span>(<span class="dt">learner =</span> <span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span>(<span class="st">"surv.ranger"</span>),</a>
<a class="sourceLine" id="cb5-13" title="13">                             <span class="dt">resampling =</span> <span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span>(<span class="st">"holdout"</span>),</a>
<a class="sourceLine" id="cb5-14" title="14">                             <span class="dt">measures =</span> <span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span>(<span class="st">"surv.graf"</span>),</a>
<a class="sourceLine" id="cb5-15" title="15">                             <span class="dt">tune_ps =</span> ParamSet<span class="op">$</span><span class="kw">new</span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb5-16" title="16">                               ParamDbl<span class="op">$</span><span class="kw">new</span>(<span class="st">"num.trees"</span>, <span class="dt">lower =</span> <span class="dv">100</span>, <span class="dt">upper =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb5-17" title="17">                             )),</a>
<a class="sourceLine" id="cb5-18" title="18">                             <span class="dt">terminator =</span> <span class="kw"><a href="https://mlr3tuning.mlr-org.com/reference/tnr.html">term</a></span>(<span class="st">"evals"</span>, <span class="dt">n_evals =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb5-19" title="19">                             <span class="dt">tuner =</span> <span class="kw"><a href="https://mlr3tuning.mlr-org.com/reference/tnr.html">tnr</a></span>(<span class="st">"grid_search"</span>)</a>
<a class="sourceLine" id="cb5-20" title="20">)</a>
<a class="sourceLine" id="cb5-21" title="21"></a>
<a class="sourceLine" id="cb5-22" title="22">design =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/benchmark_grid.html">benchmark_grid</a></span>(<span class="dt">tasks =</span> task, <span class="dt">learners =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(lrns, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(composed_lrn_glm),</a>
<a class="sourceLine" id="cb5-23" title="23">                                                   <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(tuned_lrn_rf)),</a>
<a class="sourceLine" id="cb5-24" title="24">                        <span class="dt">resamplings =</span> <span class="kw"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">rsmp</a></span>(<span class="st">"cv"</span>, <span class="dt">folds =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb5-25" title="25"></a>
<a class="sourceLine" id="cb5-26" title="26">bm =<span class="st"> </span><span class="kw"><a href="https://mlr3.mlr-org.com/reference/benchmark.html">benchmark</a></span>(design)</a>
<a class="sourceLine" id="cb5-27" title="27">bm<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"surv.harrellC"</span>,<span class="st">"surv.graf"</span>,<span class="st">"surv.grafSE"</span>), msr))[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>, <span class="dv">7</span><span class="op">:</span><span class="dv">9</span>)]</a>
<a class="sourceLine" id="cb5-28" title="28"><span class="co">#&gt;                              learner_id surv.harrellC surv.graf surv.grafSE</span></a>
<a class="sourceLine" id="cb5-29" title="29"><span class="co">#&gt; 1:                          surv.kaplan     0.5000000 0.1931783 0.008731959</span></a>
<a class="sourceLine" id="cb5-30" title="30"><span class="co">#&gt; 2:                           surv.coxph     0.5554489 0.1912178 0.008851813</span></a>
<a class="sourceLine" id="cb5-31" title="31"><span class="co">#&gt; 3:                      surv.parametric     0.4445511 0.2119920 0.010975050</span></a>
<a class="sourceLine" id="cb5-32" title="32"><span class="co">#&gt; 4: surv.kaplan.surv.glmnet.distrcompose     0.5554489 0.1993391 0.010248961</span></a>
<a class="sourceLine" id="cb5-33" title="33"><span class="co">#&gt; 5:                    surv.ranger.tuned     0.5137451 0.2153741 0.011615711</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#a-very-quick-introduction-to-survival-analysis">A very quick introduction to survival analysis</a></li>
      <li><a href="#survival-tasks">Survival Tasks</a></li>
      <li><a href="#composition">Composition</a></li>
      <li><a href="#all-together">All Together</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Raphael Sonabend, Franz Kiraly, Michel Lang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
